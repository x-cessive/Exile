/*

ExileZ Mod by [FPS]kuplion - Based on ExileZ 2.0 by Patrix87

*/

// Set Ryanzombies public variables
if (EZM_Ryanzombiesdamagecaliberneeded > 0) then 
{
	Ryanzombiesdamagecaliberneeded = EZM_Ryanzombiesdamagecaliberneeded;
	publicVariable "Ryanzombiesdamagecaliberneeded";
};

if (EZM_ryanzombieglowingeyes >= 0) then 
{
	Ryanzombiesglow = EZM_ryanzombieglowingeyes;
	publicVariable "Ryanzombiesglow";
};

if (EZM_ryanzombieshealth >= 0) then 
{
	Ryanzombieshealth = EZM_ryanzombieshealth;
	publicVariable "Ryanzombieshealth";
};

if (EZM_ryanzombieshealthdemon >= 0) then 
{
	Ryanzombieshealthdemon = EZM_ryanzombieshealthdemon;
	publicVariable "Ryanzombieshealthdemon";
};

if (EZM_ryanzombiesattackspeed >= 0) then 
{
	Ryanzombiesattackspeed = EZM_ryanzombiesattackspeed;
	publicVariable "Ryanzombiesattackspeed";
};

if (EZM_ryanzombiesattackdistance >= 0) then 
{
	Ryanzombiesattackdistance = EZM_ryanzombiesattackdistance;
	publicVariable "Ryanzombiesattackdistance";
};

if (EZM_ryanzombiesattackstrenth >= 0) then 
{
	Ryanzombiesattackstrenth = EZM_ryanzombiesattackstrenth;
	publicVariable "Ryanzombiesattackstrenth";
};

if (EZM_ryanzombiesdamage >= 0) then 
{
	Ryanzombiesdamage = EZM_ryanzombiesdamage;
	publicVariable "Ryanzombiesdamage";
};

if (EZM_ryanzombiesdamagecar >= 0) then 
{
	Ryanzombiesdamagecar = EZM_ryanzombiesdamagecar;
	publicVariable "Ryanzombiesdamagecar";
};

if (EZM_ryanzombiesdamageair >= 0) then 
{
	Ryanzombiesdamageair = EZM_ryanzombiesdamageair;
	publicVariable "Ryanzombiesdamageair";
};

if (EZM_ryanzombiesdamagetank >= 0) then 
{
	Ryanzombiesdamagetank = EZM_ryanzombiesdamagetank;
	publicVariable "Ryanzombiesdamagetank";
};

if (EZM_ryanzombiesdamagecarstrenth >= 0) then 
{
	Ryanzombiesdamagecarstrenth = EZM_ryanzombiesdamagecarstrenth;
	publicVariable "Ryanzombiesdamagecarstrenth";
};

if (EZM_ryanzombiesdamageairstrenth >= 0) then 
{
	Ryanzombiesdamageairstrenth = EZM_ryanzombiesdamageairstrenth;
	publicVariable "Ryanzombiesdamageairstrenth";
};

if (EZM_ryanzombiesdamagetankstrenth >= 0) then 
{
	Ryanzombiesdamagetankstrenth = EZM_ryanzombiesdamagetankstrenth;
	publicVariable "Ryanzombiesdamagetankstrenth";
};

if (EZM_ryanzombiescanthrow >= 0) then 
{
	Ryanzombiescanthrow = EZM_ryanzombiescanthrow;
	publicVariable "Ryanzombiescanthrow";
};

if (EZM_ryanzombiescanthrowtank >= 0) then 
{
	Ryanzombiescanthrowtank = EZM_ryanzombiescanthrowtank;
	publicVariable "Ryanzombiescanthrowtank";
};

if (EZM_ryanzombiescanthrowdistance >= 0) then 
{
	Ryanzombiescanthrowdistance = EZM_ryanzombiescanthrowdistance;
	publicVariable "Ryanzombiescanthrowdistance";
};

if (EZM_ryanzombiescanthrowdemon >= 0) then 
{
	Ryanzombiescanthrowdemon = EZM_ryanzombiescanthrowdemon;
	publicVariable "Ryanzombiescanthrowdemon";
};

if (EZM_ryanzombiescanthrowtankdemon >= 0) then 
{
	Ryanzombiescanthrowtankdemon = EZM_ryanzombiescanthrowtankdemon;
	publicVariable "Ryanzombiescanthrowtankdemon";
};

if (EZM_ryanzombiescanthrowdistancedemon >= 0) then 
{
	Ryanzombiescanthrowdistancedemon = EZM_ryanzombiescanthrowdistancedemon;
	publicVariable "Ryanzombiescanthrowdistancedemon";
};

if (EZM_ryanzombiesdisablemoaning >= 0) then 
{
	ryanzombiesdisablemoaning = EZM_ryanzombiesdisablemoaning;
	publicVariable "ryanzombiesdisablemoaning";
};

if (EZM_ryanzombiesdisableaggressive >= 0) then 
{
	ryanzombiesdisableaggressive = EZM_ryanzombiesdisableaggressive;
	publicVariable "ryanzombiesdisableaggressive";
};

if (EZM_ryanzombiescivilianattacks >= 0) then 
{
	ryanzombiescivilianattacks = EZM_ryanzombiescivilianattacks;
	publicVariable "ryanzombiescivilianattacks";
};

if (EZM_ryanzombieslogicroam >= 0) then 
{
	Ryanzombieslogicroam = EZM_ryanzombieslogicroam;
	publicVariable "Ryanzombieslogicroam";
};

if (EZM_ryanzombieslogicroamdemon >= 0) then 
{
	Ryanzombieslogicroamdemon = EZM_ryanzombieslogicroamdemon;
	publicVariable "Ryanzombieslogicroamdemon";
};

if (EZM_ryanzombiescanthrowtankdistance >= 0) then 
{
	Ryanzombiescanthrowtankdistance = EZM_ryanzombiescanthrowtankdistance;
	publicVariable "Ryanzombiescanthrowtankdistance";
};

if (EZM_ryanzombiescanthrowtankdistancedemon >= 0) then 
{
	Ryanzombiescanthrowtankdistancedemon = EZM_ryanzombiescanthrowtankdistancedemon;
	publicVariable "Ryanzombiescanthrowtankdistancedemon";
};

if (EZM_ryanzombiesdisablebleeding >= 0) then 
{
	ryanzombiesdisablebleeding = EZM_ryanzombiesdisablebleeding;
	publicVariable "ryanzombiesdisablebleeding";
};

if (EZM_ryanzombiesstartinganim >= 0) then 
{
	ryanzombiesstartinganim = EZM_ryanzombiesstartinganim;
	publicVariable "ryanzombiesstartinganim";
};

if (EZM_ryanzombieslimit >= 0) then 
{
	ryanzombieslimit = EZM_ryanzombieslimit;
	publicVariable "ryanzombieslimit";
};

if (EZM_ryanzombiesjump >= 0) then 
{
	Ryanzombiesjump = EZM_ryanzombiesjump;
	publicVariable "Ryanzombiesjump";
};

if (EZM_ryanzombiesjumpdemon >= 0) then 
{
	Ryanzombiesjumpdemon = EZM_ryanzombiesjumpdemon;
	publicVariable "Ryanzombiesjumpdemon";
};

if (EZM_ryanzombiesfeed >= 0) then 
{
	Ryanzombiesfeed = EZM_ryanzombiesfeed;
	publicVariable "Ryanzombiesfeed";
};

if (EZM_ryanzombiesfeeddemon >= 0) then 
{
	Ryanzombiesfeeddemon = EZM_ryanzombiesfeeddemon;
	publicVariable "Ryanzombiesfeeddemon";
};

if (EZM_ryanzombiesinfection >= 0) then 
{
	Ryanzombiesinfection = EZM_ryanzombiesinfection;
	publicVariable "Ryanzombiesinfection";
};

if (EZM_ryanzombiesinfectedchance >= 0) then 
{
	ryanzombiesinfectedchance = EZM_ryanzombiesinfectedchance;
	publicVariable "ryanzombiesinfectedchance";
};

if (EZM_ryanzombiesinfectedrate >= 0) then 
{
	ryanzombiesinfectedrate = EZM_ryanzombiesinfectedrate;
	publicVariable "ryanzombiesinfectedrate";
};

if (EZM_ryanzombiesinfectedsymptoms >= 0) then 
{
	ryanzombiesinfectedsymptoms = EZM_ryanzombiesinfectedsymptoms;
	publicVariable "ryanzombiesinfectedsymptoms";
};

if (EZM_ryanzombiesinfecteddeath >= 0) then 
{
	ryanzombiesinfecteddeath = EZM_ryanzombiesinfecteddeath;
	publicVariable "ryanzombiesinfecteddeath";
};

if (EZM_ryanzombiesantivirusduration >= 0) then 
{
	ryanzombiesantivirusduration = EZM_ryanzombiesantivirusduration;
	publicVariable "ryanzombiesantivirusduration";
};

if (EZM_ryanzombiesmovementspeedwalker >= 0) then 
{
	ryanzombiesmovementspeedwalker = EZM_ryanzombiesmovementspeedwalker;
	publicVariable "ryanzombiesmovementspeedwalker";
};

if (EZM_ryanzombiesmovementspeedslow >= 0) then 
{
	ryanzombiesmovementspeedslow = EZM_ryanzombiesmovementspeedslow;
	publicVariable "ryanzombiesmovementspeedslow";
};

if (EZM_ryanzombiesmovementspeedmedium >= 0) then 
{
	ryanzombiesmovementspeedmedium = EZM_ryanzombiesmovementspeedmedium;
	publicVariable "ryanzombiesmovementspeedmedium";
};

if (EZM_ryanzombiesmovementspeedfast >= 0) then 
{
	ryanzombiesmovementspeedfast = EZM_ryanzombiesmovementspeedfast;
	publicVariable "ryanzombiesmovementspeedfast";
};

if (EZM_ryanzombiesmovementspeeddemon >= 0) then 
{
	ryanzombiesmovementspeeddemon = EZM_ryanzombiesmovementspeeddemon;
	publicVariable "ryanzombiesmovementspeeddemon";
};

if (EZM_ryanzombiesmovementspeedspider >= 0) then 
{
	ryanzombiesmovementspeedspider = EZM_ryanzombiesmovementspeedspider;
	publicVariable "ryanzombiesmovementspeedspider";
};

if (EZM_ryanzombiesmovementspeedcrawler >= 0) then 
{
	ryanzombiesmovementspeedcrawler = EZM_ryanzombiesmovementspeedcrawler;
	publicVariable "ryanzombiesmovementspeedcrawler";
};

// CompileFinal Files
EZM_CreateTriggers = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\CreateTriggers.sqf";
EZM_TriggerLoop = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\TriggerLoop.sqf";
EZM_InitGroup = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\InitGroup.sqf";
EZM_SpawnZombie = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\SpawnZombie.sqf";
EZM_ZMPKilled = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\MPKilled.sqf";
EZM_GetRandomLocation = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\GetRandomLocation.sqf";
EZM_VerifyLocation = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\VerifyLocation.sqf";
EZM_TurnTheLightsOff = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\LightsOff.sqf";

// Compile the Zombie Monitor
EZM_ZombieMonitor = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\ZombieMonitor.sqf";

// Compile the Dead Zombie Monitor
EZM_DeadZombieMonitor = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\DeadZombieMonitor.sqf";

// Compile the Harassing Zombies Loop
EZM_HarassingZombiesThread = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\HarassingZombiesThread.sqf";

// Compile the Horde Loop
EZM_HordeThread = compileFinal preprocessFileLineNumbers "exilez_mod\scripts\HordeThread.sqf";

// Add Zombie Monitor to ExileServer Thread
if (EZM_Debug) then
{
	[EZM_MaxTime/2, EZM_ZombieMonitor, [], true] call ExileServer_system_thread_addTask;
	diag_log "ExileZ Mod: Added Debug Zombie Monitor to ExileServer Thread";
}
else
{
	[EZM_MaxTime, EZM_ZombieMonitor, [], true] call ExileServer_system_thread_addTask;
	diag_log "ExileZ Mod: Added Zombie Monitor to ExileServer Thread";
};

// Add Dead Zombie Monitor to ExileServer Thread
if (EZM_Debug) then
{
	[EZM_MaxTimeDead/4, EZM_DeadZombieMonitor, [], true] call ExileServer_system_thread_addTask;
	diag_log "ExileZ Mod: Added Debug Dead Zombie Monitor to ExileServer Thread";
}
else
{
	[EZM_MaxTimeDead, EZM_DeadZombieMonitor, [], true] call ExileServer_system_thread_addTask;
	diag_log "ExileZ Mod: Added Dead Zombie Monitor to ExileServer Thread";
};

// Add Harassing Zombies Loop to ExileServer Thread
if (EZM_UseHarassingZombies) then
{
	if (EZM_Debug) then
	{
		[EZM_HarassingLoopTime/2, EZM_HarassingZombiesThread, [EZM_HarassingConfig], true] call ExileServer_system_thread_addTask;
		diag_log "ExileZ Mod: Added Debug Harassing Zombies Loop to ExileServer Thread";
	}
	else
	{
		[EZM_HarassingLoopTime, EZM_HarassingZombiesThread, [EZM_HarassingConfig], true] call ExileServer_system_thread_addTask;
		diag_log "ExileZ Mod: Added Harassing Zombies Loop to ExileServer Thread";
	};
};

// Add Horde Loop to ExileServer Thread
if (EZM_UseHorde) then
{
	if (EZM_Debug) then
	{
		[EZM_HordeLoopTime*15, EZM_HordeThread, [EZM_HordeConfig], true] call ExileServer_system_thread_addTask;
		diag_log "ExileZ Mod: Added Debug Horde Loop to ExileServer Thread";
	}
	else
	{
		[EZM_HordeLoopTime*60, EZM_HordeThread, [EZM_HordeConfig], true] call ExileServer_system_thread_addTask;
		diag_log "ExileZ Mod: Added Horde Loop to ExileServer Thread";
	};
};

//Create Triggers
_zgroupsArray = [];
if (EZM_UseTriggers) then
{
	{
		_useThisTrigger = _x select 0;
		_triggerPositions = _x select 1;
		if (_useThisTrigger) then
		{
			
			//Weight Zombie Group
			_currentTrigger = _x;
			_zgroup = _currentTrigger select 13;
			if (EZM_Debug) then
			{
				diag_log format["ExileZ Mod: Compounding Zombie Group Weight, Selected Group Trigger Index : %1",_forEachIndex];
			};
			
			if !(_zgroup in _zgroupsArray) then
			{
				_count = 0;
				{
					_count = _count + (_x select 1);
					if (EZM_Debug) then
					{
						diag_log format["ExileZ Mod: Zombie Type Index : %1		Weight : %2		Compound Weight Value : 	%3",_forEachIndex,_x select 1,_count];
					};
					(_zgroup select _forEachIndex) set [1,_count];
				}
				foreach (_zgroup);
				
				_zgroupsArray append [_zgroup];
			}
			else
			{
				if (EZM_Debug) then
				{
					diag_log "ExileZ Mod: Compounding Weight For This Zombie Group Already Done!";
				};
			};

			//Create triggers
			{
				nul = [_x,_CurrentTrigger] spawn EZM_CreateTriggers;
				uisleep 0.01;
			}foreach (_triggerPositions);
		};
	}foreach EZM_Triggers;
};

// Kill those lights
if (EZM_LightsOff) then
{
	 [] call EZM_TurnTheLightsOff;
};

// Add and extend traders to blacklisted areas
if ((EZM_UseAreaBlacklist) && (EZM_BlacklistExtendTraders)) then
{
	{
		if ((getMarkerType _x) isEqualTo "ExileTraderZone") then
		{
			EZM_BlacklistedTraders pushBack
			[
				getMarkerPos _x, 
				((getMarkerSize _x) select 0) + EZM_BlacklistExtendDistance
			];
		};
	}
	forEach allMapMarkers;

	// Add the new blacklist to the old
	EZM_BlacklistedPositions append EZM_BlacklistedTraders;
};

diag_log format["ExileZ Mod: Version %1 Started at (%2)", exileZmod_version, time];